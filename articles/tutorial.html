<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial • hydromad</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Tutorial">
<meta property="og:description" content="hydromad">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hydromad</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9-27</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/hydromad.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tutorial.html">Tutorial</a>
    </li>
    <li>
      <a href="../articles/hbv.html">HBV model</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Releases</li>
    <li>
      <a href="http://github.com/josephguillaume/hydromad" class="external-link">hydromad 0.9-27</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/josephguillaume/hydromad/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="tutorial_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Tutorial</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/josephguillaume/hydromad/blob/HEAD/vignettes/tutorial.Rmd" class="external-link"><code>vignettes/tutorial.Rmd</code></a></small>
      <div class="hidden name"><code>tutorial.Rmd</code></div>

    </div>

    
    
<div class="section level1">
<h1 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h1>
<p>The <strong>hydromad</strong> package is designed for hydrological modelling and associated data analysis. It is focussed on a <em>top-down</em>, spatially lumped, empirical approach to environmental hydrology. In practice the emphasis is on models of rainfall runoff in catchments (watersheds). Such models predict streamflow from time series of areal rainfall and temperature or potential evapo-transpiration. They can be calibrated to time series of observed data.</p>
<p>As <em>spatially lumped</em> models, they do not explicitly represent spatial variation over the catchment area. In particular, the standard formulations do not attempt to model effects of changes in land cover. These models are usually calibrated to a period of observed streamflow, and the parameters defining the modelled relationship between rainfall, evaporation and flow are assumed to be <em>stationary</em> in this period.</p>
<p>The modelling framework in the <strong>hydromad</strong> package is based on a two-component structure: (1) a <em>soil moisture accounting</em> (SMA) module; and (2) a <em>routing</em> or <em>unit hydrograph</em> module (Figure @ref(fig:model-framework)). The SMA model converts rainfall and temperature into <em>effective rainfall</em> — the amount of rainfall which eventually reaches the catchment outlet as streamflow (i.e. that which is not lost as evaporation etc). The routing module converts effective rainfall into streamflow, which amounts to defining the peak response and shape of the recession curve. It is usually a linear transfer function, which can be as simple as a single exponential recession (i.e. constant decay rate), although variants with non-linearities are also available.</p>
<div class="figure" style="text-align: center">
<img src="tutorial_files/figure-html/model-framework-1.png" alt="The modelling framework in the **hydromad** package." width="576"><p class="caption">
The modelling framework in the <strong>hydromad</strong> package.
</p>
</div>
<p>The <strong>hydromad</strong> package is intended for:</p>
<ul>
<li>defining and fitting spatially-lumped hydrological models to observed data;</li>
<li>simulating these models, including model state variables and component flow separation.</li>
<li>evaluating and comparing these models: summarising performance by different measures and over time, using graphical displays (hydrograph, flow duration curve, residuals, etc) and statistics;</li>
<li>integration with other types of data analysis and model analysis in <code>R</code>, including sensitivity and uncertainty analyis.</li>
</ul>
<p>This tutorial describes how to get started with the <strong>hydromad</strong> <code>R</code> package. It covers the basics of reading data in from files, converting it into the appropriate format, and fitting and analysing a simple model.</p>
<p>Once you have <code>R</code> running (See <a href="http://hydromad.catchment.org/" class="external-link">http://www.r-project.org/</a>) and have installed the <strong>hydromad</strong> package (See <a href="http://hydromad.catchment.org/" class="external-link">http://hydromad.catchment.org/</a>), you can load it:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://hydromad.catchment.org/" class="external-link">hydromad</a></span><span class="op">)</span></code></pre></div>
</div>
<div class="section level1">
<h1 id="input-data">Input data<a class="anchor" aria-label="anchor" href="#input-data"></a>
</h1>
<p>The example we will look at is the Cotter River catchment at Gingera (gauge 410730) in the Australian Capital Territory, Australia. This is a 148 km<span class="math inline">\(^2\)</span> catchment managed for urban water supply. Areal rainfall was estimated from several rain gauges operated by the Bureau of Meteorology and EcoWise. The temperature records come from Canberra Airport.</p>
<p>The Cotter data is built in to the <strong>hydromad</strong> package, and can be loaded into the workspace with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Cotter</span><span class="op">)</span></code></pre></div>
<p>See Appendix @ref(reading-in-data) for a demonstration of reading in the time series data from files.</p>
</div>
<div class="section level1">
<h1 id="data-checking">Data checking<a class="anchor" aria-label="anchor" href="#data-checking"></a>
</h1>
<p>In a real data analysis problem, data checking is a central issue. However, as this document aims to introduce the core modelling functions, only a simple check will be demonstrated here. The most obvious thing to do is to plot the time series, as shown in Figure @ref(fig:dataplot).</p>
<p><em>To plot the raw (daily) time series:</em></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">Cotter</span><span class="op">)</span></code></pre></div>
<p><em>To plot a section of the time series:</em></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">Cotter</span>, start <span class="op">=</span> <span class="st">"1974-01-01"</span>, end <span class="op">=</span> <span class="st">"1975-01-01"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><em>And to plot the timeseries aggregated to a monthly timestep:</em></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">monthlyPQE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">Cotter</span>, <span class="va">as.yearmon</span>, <span class="va">mean</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">monthlyPQE</span>,
       screens <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Streamflow (mm/day)"</span>, <span class="st">"Areal rain (mm/day)"</span>, <span class="st">"Temperature (deg. C)"</span><span class="op">)</span>,
       xlab <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="tutorial_files/figure-html/dataplot-1.png" alt="Input data, averaged over months" width="576"><p class="caption">
Input data, averaged over months
</p>
</div>
<p>Table @ref(tab:datasummary) shows the mean and quartiles of each input data series. One measure that is of key interest in hydrology is the <em>runoff ratio</em>, the proportion of the rainfall which flows out of the catchment. In a simple case this is just <code>sum(Q) / sum(P)</code>, but as we have missing values, we should only compare the common observations:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ok</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html" class="external-link">complete.cases</a></span><span class="op">(</span><span class="va">Cotter</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">Cotter</span>, <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Q</span><span class="op">[</span><span class="va">ok</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">P</span><span class="op">[</span><span class="va">ok</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] 0.279101</span></code></pre>
<p>This figure is within the range we would expect, so is looks like we probably have the right data series and units.</p>
<p>To estimate the delay time between rainfall and a consequent streamflow response, we can look at the cross-correlation function. The <strong>hydromad</strong> function <code>estimateDelay</code> picks out the lag time corresponding to the maximum correlation between rainfall and <em>rises in</em> streamflow. In the Cotter this is 0 days. For more detail there is a function <code>rollccf</code> which calculates the cross-correlation in a moving window through the data, shown in Figure @ref(fig:rollccf-plot). When the cross-correlation value drops down towards zero, there is little connection between rainfall and streamflow, and you should start to worry about the data. If the lag 1 value jumps above the lag 0 value, this indicates that the delay time has changed.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rollccf.html">rollccf</a></span><span class="op">(</span><span class="va">Cotter</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">x</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/extendrange.html" class="external-link">extendrange</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1980-01-01"</span>,<span class="st">"1990-01-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="tutorial_files/figure-html/rollccf-plot-1.png" alt="Cross-correlation between rainfall and streamflow rises, in two rolling windows of width 90 days and 365 days." width="700"><p class="caption">
Cross-correlation between rainfall and streamflow rises, in two rolling windows of width 90 days and 365 days.
</p>
</div>
</div>
<div class="section level1">
<h1 id="model-specification">Model Specification<a class="anchor" aria-label="anchor" href="#model-specification"></a>
</h1>
<p>A <strong>hydromad</strong> object encapsulates the chosen model form, parameter values (or ranges of values), as well as results. The model form is divided into two components: SMA (Soil Moisture Accounting) and routing. Additionally, a specification can be given for fitting the routing component (<code>rfit</code>). If given, this is applied automatically to fit the routing component after the SMA parameters have been specified.</p>
<p>Let us define some data periods. We will fit a model to one, the calibration period, and then simulate it on the other periods to cross-check model performance.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ts70s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">Cotter</span>, start <span class="op">=</span> <span class="st">"1970-01-01"</span>, end <span class="op">=</span> <span class="st">"1979-12-31"</span><span class="op">)</span>
<span class="va">ts80s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">Cotter</span>, start <span class="op">=</span> <span class="st">"1980-01-01"</span>, end <span class="op">=</span> <span class="st">"1989-12-31"</span><span class="op">)</span>
<span class="va">ts90s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/window.html" class="external-link">window</a></span><span class="op">(</span><span class="va">Cotter</span>, start <span class="op">=</span> <span class="st">"1990-01-01"</span>, end <span class="op">=</span> <span class="st">"1999-12-31"</span><span class="op">)</span></code></pre></div>
<p>When we first set up the model, most of the parameters are not uniquely specified, but rather have a range of possible values. These defaults are taken from <code><a href="../reference/hydromad.options.html">hydromad.options()</a></code>, and they can be over-ridden by arguments to the <strong>hydromad</strong> function.</p>
<p>A nice simple starting point is the classic IHACRES model of Jakeman and Hornberger (1993), which is a Soil Moisture Accounting model referred to here as <code>"cwi"</code> (Catchment Wetness Index).</p>
<p>The routing component typically used in IHACRES is a Unit Hydrograph composed of exponential components, a structure referred to here as <code>"expuh"</code>. Up to three time constants can be specified, referred to as <code>tau_s</code> (slow component <span class="math inline">\(\tau_s\)</span>), <code>tau_q</code> (quick component <span class="math inline">\(\tau_q\)</span>) and <code>tau_3</code>. The partitioning of flow between the stores is set by <code>v_s</code> (fractional volume in the slow component <span class="math inline">\(v_s\)</span>), and by default the quick flow component is assigned the remainder.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>When a model structure is specified, default parameter ranges for the given SMA model are applied, and others can be specified:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cotterMod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hydromad.html">hydromad</a></span><span class="op">(</span><span class="va">ts90s</span>, sma <span class="op">=</span> <span class="st">"cwi"</span>, routing <span class="op">=</span> <span class="st">"expuh"</span>,
                      tau_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">100</span><span class="op">)</span>, tau_q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span><span class="op">)</span>, v_s <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cotterMod</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Hydromad model with "cwi" SMA and "expuh" routing:</span>
<span class="co">## Start = 1990-01-01, End = 1999-12-31</span>
<span class="co">## </span>
<span class="co">## SMA Parameters:</span>
<span class="co">##       lower upper     </span>
<span class="co">## tw        0   100     </span>
<span class="co">## f         0     8     </span>
<span class="co">## scale    NA    NA     </span>
<span class="co">## l         0     0 (==)</span>
<span class="co">## p         1     1 (==)</span>
<span class="co">## t_ref    20    20 (==)</span>
<span class="co">## Routing Parameters:</span>
<span class="co">##       lower upper  </span>
<span class="co">## tau_s     5   100  </span>
<span class="co">## tau_q     0     5  </span>
<span class="co">## v_s       0     1</span></code></pre>
<p>With this model specification, we can choose to calibrate the model in various ways, or to simulate from the specified parameter space, or to run sensitivity or uncertainty analysis.</p>
<div class="section level2">
<h2 id="calibration">Calibration<a class="anchor" aria-label="anchor" href="#calibration"></a>
</h2>
<p>Currently implemented calibration methods include simple sampling schemes (<code>fitBySampling</code>), general optimisation methods with multistart or presampling (<code>fitByOptim</code>) and the more sophisticated Shuffled Complex Evolution (<code>fitBySCE</code>) and Differential Evolution (<code>fitByDE</code>) methods. All attempt to maximise a given objective function.</p>
<p>The objective function can be specified as the <code>objective</code> argument to these functions, or by setting <code>hydromad.options(objective = )</code>. It is given as an R function which may refer to the values <code>Q</code> and <code>X</code>, representing observed and modelled flow, respectively. For more advanced use it may also refer to <code>U</code> (modelled effective rainfall), or the full input <code>DATA</code> matrix.</p>
<p>The <code>nseStat</code> function implements a generalisation of the familiar <span class="math inline">\(R^2\)</span> coefficient of efficiency (Nash and Sutcliffe, 1970):</p>
<p><span class="math display">\[
  \mathrm{nseStat}(Q,X) = \frac{ \sum |Q_* - X_*|^2 }{ \sum |Q_* - Z_*|^2 }
\]</span> where <span class="math inline">\(Q\)</span> and <span class="math inline">\(X\)</span> are the observed and modelled values; <span class="math inline">\(Z\)</span> is the result from a reference model, which is the baseline for comparison. <span class="math inline">\(Z\)</span> defaults to the mean of observed data <span class="math inline">\(\mathrm{E}(Q_*)\)</span>, corresponding to the typical <span class="math inline">\(R^2\)</span> statistic. Subscript <span class="math inline">\(*\)</span> denotes transformed data, and the transform can be specified. See <code><a href="../reference/nseStat.html">?nseStat</a></code> and <code><a href="../reference/hydromad.stats.html">?hydromad.stats</a></code> for examples.</p>
<p>Here we use the default, which is a weighted sum of the <span class="math inline">\(R^2\)</span> of square-root transformed data, and (with less weight) the <span class="math inline">\(R^2\)</span> of monthly-aggregated data.</p>
<p>For this simple example, the model will be calibrated using the <code>fitByOptim</code> function, which performs parameter sampling over the pre-specified ranges, selecting the best of these, and then runs an optimisation algorithm from that starting point.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cotterMod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">cotterMod</span>, routing <span class="op">=</span> <span class="st">"armax"</span>, rfit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"sriv"</span>, order <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">2</span>, m<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">cotterFit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fitByOptim.html">fitByOptim</a></span><span class="op">(</span><span class="va">cotterMod</span>, samples <span class="op">=</span> <span class="fl">100</span>, method <span class="op">=</span> <span class="st">"PORT"</span><span class="op">)</span></code></pre></div>
<p>See the help pages <code><a href="../reference/hydromad.html">help("hydromad")</a></code> and <code><a href="../reference/fitByOptim.html">help("fitByOptim")</a></code> for details of some of the options available.</p>
</div>
</div>
<div class="section level1">
<h1 id="model-output">Model Output<a class="anchor" aria-label="anchor" href="#model-output"></a>
</h1>
<p>Now that we have an object representing a calibrated model, what can we do with it? There are many standard <code>R</code> functions which have methods for `hydromad} objects, which allow one to:</p>
<ul>
<li>
<strong>view model info</strong> using <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code>, <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, and <code><a href="../reference/objFunVal.html">objFunVal()</a></code>
</li>
<li>
<strong>extract parameter values</strong> using <code><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef()</a></code>.</li>
<li>
<strong>access data</strong> with <code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted()</a></code>, <code><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals()</a></code>, and <code><a href="../reference/utilities.html">observed()</a></code>. (These exclude the warm-up period by default.)</li>
<li>
<strong>run with new data</strong> using <code><a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a></code> or <code><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict()</a></code>.</li>
<li>
<strong>simulate from parameter ranges</strong> using <code><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate()</a></code>.</li>
<li>
<strong>generate plots</strong> using <code><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot()</a></code>, <code><a href="https://rdrr.io/pkg/lattice/man/qqmath.html" class="external-link">qqmath()</a></code>, etc.</li>
</ul>
<p>For details, see the examples below, the user manual, and the help page of each function.\footnote{Note that to get help for generic functions it is necessary to specify the method for <strong>hydromad</strong> objects: e.g. <code><a href="../reference/predict.hydromad.html">?predict.hydromad</a></code> or <code><a href="../reference/xyplot.hydromad.html">?xyplot.hydromad</a></code>. The help pages are also available from the web site <a href="http://hydromad.catchment.org/" class="external-link uri">http://hydromad.catchment.org/</a>.</p>
<p>Most basically, one can extract the modelled streamflow time series with the function <code><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted()</a></code>, and this can of course be used with any of <code>R</code>’s library of analysis functions. A quick way to view the modelled and observed streamflow time series together is to call <code><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot()</a></code> on the model object, as in Figure @ref(fig:obs-mod-plot). Examples below also show the output from calling the functions <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> and <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> on the model object.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">cotterFit</span>, with.P <span class="op">=</span> <span class="cn">TRUE</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1994-01-01"</span>, <span class="st">"1997-01-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="tutorial_files/figure-html/obs-mod-plot-1.png" alt="Observed vs modelled streamflow in part of the calibration period." width="700"><p class="caption">
Observed vs modelled streamflow in part of the calibration period.
</p>
</div>
<p><em>To display information and parameters of a model:</em></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">cotterFit</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Hydromad model with "cwi" SMA and "armax" routing:</span>
<span class="co">## Start = 1990-01-01, End = 1999-12-31</span>
<span class="co">## </span>
<span class="co">## SMA Parameters:</span>
<span class="co">##        tw          f      scale          l          p      t_ref  </span>
<span class="co">## 29.376527   1.910419   0.001693   0.000000   1.000000  20.000000  </span>
<span class="co">## Routing Parameters:</span>
<span class="co">##     a_1      a_2      b_0      b_1    delay  </span>
<span class="co">##  1.5236  -0.5388   0.1567  -0.1415   0.0000  </span>
<span class="co">## TF Structure: S + Q (two stores in parallel)</span>
<span class="co">##     Poles:0.558, 0.9656 </span>
<span class="co">## </span>
<span class="co">## Fit: ($fit.result)</span>
<span class="co">## fitByOptim(MODEL = cotterMod, method = "PORT", samples = 100)</span>
<span class="co">##      195 function evaluations in 25.54 seconds </span>
<span class="co">## </span>
<span class="co">## Routing fit info:  list(TRUE, 6)</span></code></pre>
<p>Note one can get hold of the parameter values using <code>coef(cotterFit)</code> or <code>coef(cotterFit, which = "routing")</code> (for the unit hydrograph only).</p>
<p><em>To display basic performance statistics for a model:</em></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">cotterFit</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## </span>
<span class="co">## Call:</span>
<span class="co">## hydromad(DATA = ts90s, tau_s = c(5, 100), tau_q = c(0, 5), v_s = c(0, </span>
<span class="co">##     1), sma = "cwi", routing = "armax", rfit = list("sriv", order = c(n = 2, </span>
<span class="co">##     m = 1)), tw = 29.3765, f = 1.91042, scale = 0.00169348)</span>
<span class="co">## </span>
<span class="co">## Time steps: 3552 (33 missing).</span>
<span class="co">## Runoff ratio (Q/P): (0.8179 / 3.208) = 0.2549</span>
<span class="co">## rel bias: -0.03333</span>
<span class="co">## r squared: 0.7733</span>
<span class="co">## r sq sqrt: 0.8356</span>
<span class="co">## r sq log: 0.8511</span>
<span class="co">## </span>
<span class="co">## For definitions see ?hydromad.stats</span></code></pre>
<p>Calculating basic performance statistics for a model. The <code>summary</code> function actually returns a list, containing the values of various performance statistics.</p>
</div>
<div class="section level1">
<h1 id="model-simulation">Model Simulation<a class="anchor" aria-label="anchor" href="#model-simulation"></a>
</h1>
<p>We can simulate this model on the other periods using the `<code>update</code> function:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sim70s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">cotterFit</span>, newdata <span class="op">=</span> <span class="va">ts70s</span><span class="op">)</span>
<span class="va">sim80s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">cotterFit</span>, newdata <span class="op">=</span> <span class="va">ts80s</span><span class="op">)</span>
<span class="va">simAll</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">cotterFit</span>, newdata <span class="op">=</span> <span class="va">Cotter</span><span class="op">)</span></code></pre></div>
<p>For <em>verification</em> purposes, we would like to calculate performance statistics for the whole dataset but excluding the calibration period. The easiest way to do this is to set the observed streamflow data in the calibration period to `NA} (missing), and then run the simulation:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tsVerif</span> <span class="op">&lt;-</span> <span class="va">Cotter</span>
<span class="va">tsVerif</span><span class="op">$</span><span class="va">Q</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">time</a></span><span class="op">(</span><span class="va">ts90s</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">simVerif</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">cotterFit</span>, newdata <span class="op">=</span> <span class="va">tsVerif</span><span class="op">)</span></code></pre></div>
<p>It is convenient to group these models together into a `runlist}, which is just a list of fitted models:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">allMods</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runlist.html">runlist</a></span><span class="op">(</span>calibration <span class="op">=</span> <span class="va">cotterFit</span>, <span class="va">sim70s</span>, <span class="va">sim80s</span>, <span class="va">simVerif</span><span class="op">)</span></code></pre></div>
<p>The predicted time series (hydrograph) and cumulative distribution (flow duration curve) can be generated as in Figures @ref(fig:obs-mod-plots) and @ref(fig:fdc-plot).</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">allMods</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>, scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="tutorial_files/figure-html/obs-mod-plots-1.png" alt="Observed vs modelled streamflow in validation periods." width="700"><p class="caption">
Observed vs modelled streamflow in validation periods.
</p>
</div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">allMods</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>Performance statistics for a set of models.</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">rel.bias</th>
<th align="right">r.squared</th>
<th align="right">r.sq.sqrt</th>
<th align="right">r.sq.log</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">calibration</td>
<td align="right">-0.0333273</td>
<td align="right">0.7733200</td>
<td align="right">0.8355996</td>
<td align="right">0.8510658</td>
</tr>
<tr class="even">
<td align="left">sim70s</td>
<td align="right">-0.3257152</td>
<td align="right">0.6845715</td>
<td align="right">0.6760291</td>
<td align="right">0.6073933</td>
</tr>
<tr class="odd">
<td align="left">sim80s</td>
<td align="right">-0.1266065</td>
<td align="right">0.7316587</td>
<td align="right">0.8276088</td>
<td align="right">0.8618916</td>
</tr>
<tr class="even">
<td align="left">simVerif</td>
<td align="right">-0.2082360</td>
<td align="right">0.6936858</td>
<td align="right">0.7530953</td>
<td align="right">0.7547944</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">simAll</span>, breaks <span class="op">=</span> <span class="st">"5 years"</span><span class="op">)</span></code></pre></div>
<table style="width:100%;" class="table">
<caption>Viewing a break-down the performance of a model over 5-year blocks.</caption>
<colgroup>
<col width="11%">
<col width="10%">
<col width="8%">
<col width="9%">
<col width="10%">
<col width="10%">
<col width="12%">
<col width="10%">
<col width="10%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">timesteps</th>
<th align="right">missing</th>
<th align="right">mean.P</th>
<th align="right">mean.Q</th>
<th align="right">runoff</th>
<th align="right">rel.bias</th>
<th align="right">r.squared</th>
<th align="right">r.sq.sqrt</th>
<th align="right">r.sq.log</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1966-01-01</td>
<td align="right">1606</td>
<td align="right">0</td>
<td align="right">2.674010</td>
<td align="right">0.8529382</td>
<td align="right">0.3189735</td>
<td align="right">-0.31862832</td>
<td align="right">0.5330459</td>
<td align="right">0.6320879</td>
<td align="right">0.6800752</td>
</tr>
<tr class="even">
<td align="left">1971-01-01</td>
<td align="right">1826</td>
<td align="right">0</td>
<td align="right">3.173708</td>
<td align="right">1.1636603</td>
<td align="right">0.3666564</td>
<td align="right">-0.33326550</td>
<td align="right">0.7184575</td>
<td align="right">0.6990362</td>
<td align="right">0.6183019</td>
</tr>
<tr class="odd">
<td align="left">1976-01-01</td>
<td align="right">1827</td>
<td align="right">0</td>
<td align="right">2.670914</td>
<td align="right">0.7185062</td>
<td align="right">0.2690114</td>
<td align="right">-0.22798441</td>
<td align="right">0.6642018</td>
<td align="right">0.7161991</td>
<td align="right">0.6812281</td>
</tr>
<tr class="even">
<td align="left">1981-01-01</td>
<td align="right">1826</td>
<td align="right">0</td>
<td align="right">2.914743</td>
<td align="right">0.7902770</td>
<td align="right">0.2711310</td>
<td align="right">-0.11380336</td>
<td align="right">0.7752632</td>
<td align="right">0.8424474</td>
<td align="right">0.8612795</td>
</tr>
<tr class="odd">
<td align="left">1986-01-01</td>
<td align="right">1826</td>
<td align="right">33</td>
<td align="right">3.153246</td>
<td align="right">0.9562480</td>
<td align="right">0.3032583</td>
<td align="right">-0.15957919</td>
<td align="right">0.6940339</td>
<td align="right">0.8041123</td>
<td align="right">0.8534372</td>
</tr>
<tr class="even">
<td align="left">1991-01-01</td>
<td align="right">1826</td>
<td align="right">0</td>
<td align="right">3.356369</td>
<td align="right">0.9152752</td>
<td align="right">0.2726980</td>
<td align="right">-0.09288265</td>
<td align="right">0.7750202</td>
<td align="right">0.8412327</td>
<td align="right">0.8532968</td>
</tr>
<tr class="odd">
<td align="left">1996-01-01</td>
<td align="right">1827</td>
<td align="right">0</td>
<td align="right">3.037909</td>
<td align="right">0.6267362</td>
<td align="right">0.2063051</td>
<td align="right">0.14456272</td>
<td align="right">0.7568331</td>
<td align="right">0.8128100</td>
<td align="right">0.8381424</td>
</tr>
<tr class="even">
<td align="left">2001-01-01</td>
<td align="right">893</td>
<td align="right">0</td>
<td align="right">2.472430</td>
<td align="right">0.3951501</td>
<td align="right">0.1598226</td>
<td align="right">0.16406907</td>
<td align="right">0.5196486</td>
<td align="right">0.6693259</td>
<td align="right">0.6949333</td>
</tr>
<tr class="odd">
<td align="left">2001-01-01</td>
<td align="right">893</td>
<td align="right">0</td>
<td align="right">2.472430</td>
<td align="right">0.3951501</td>
<td align="right">0.1598226</td>
<td align="right">0.16406907</td>
<td align="right">0.5196486</td>
<td align="right">0.6693259</td>
<td align="right">0.6949333</td>
</tr>
</tbody>
</table>
<p><em>To plot performance statistics over time:</em></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">twoYrStats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">simAll</span>, breaks <span class="op">=</span> <span class="st">"2 years"</span><span class="op">)</span>
<span class="va">statSeries</span> <span class="op">&lt;-</span> <span class="va">twoYrStats</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"r.squared"</span>, <span class="st">"r.sq.sqrt"</span>, <span class="st">"rel.bias"</span>, <span class="st">"runoff"</span><span class="op">)</span><span class="op">]</span>
<span class="co">## cut off crazy R Squared values below 0 (for plotting)</span>
<span class="va">statSeries</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">statSeries</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="fl">0</span><span class="op">)</span>
<span class="va">statSeries</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="va">statSeries</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, <span class="fl">0</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">statSeries</span>, type <span class="op">=</span> <span class="st">"s"</span>, lwd <span class="op">=</span> <span class="fl">2</span>,
         ylab <span class="op">=</span> <span class="st">"statistic"</span>, xlab <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,
  `observed streamflow` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="fu"><a href="../reference/utilities.html">observed</a></span><span class="op">(</span><span class="va">simAll</span><span class="op">)</span><span class="op">)</span>,
  layout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">5</span><span class="op">)</span>, x.same <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu">latticeExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/latticeExtra/man/layer.html" class="external-link">layer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/panel.functions.html" class="external-link">panel.refline</a></span><span class="op">(</span>h <span class="op">=</span> <span class="fl">0</span>, v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">time</a></span><span class="op">(</span><span class="va">statSeries</span><span class="op">)</span><span class="op">)</span>, under<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="tutorial_files/figure-html/r2-breaks-plot-1.png" alt="Performance statistics plotted over time in regular 2 year blocks. The runoff coefficient and observed streamflow data are also shown." width="700"><p class="caption">
Performance statistics plotted over time in regular 2 year blocks. The runoff coefficient and observed streamflow data are also shown.
</p>
</div>
<p><em>To plot the flow duration curve for modelled vs observed data in the calibration period:</em></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/qqmath.html" class="external-link">qqmath</a></span><span class="op">(</span><span class="va">cotterFit</span>, scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>, type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>,<span class="st">"g"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p><em>To plot a flow duration curve for each of the simulated models:</em></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/qqmath.html" class="external-link">qqmath</a></span><span class="op">(</span><span class="va">allMods</span>, type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"l"</span>,<span class="st">"g"</span><span class="op">)</span>, 
       scales <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,
       xlab <span class="op">=</span> <span class="st">"Standard normal variate"</span>,
       ylab <span class="op">=</span> <span class="st">"Flow (mm/day)"</span>, 
       f.value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/ppoints.html" class="external-link">ppoints</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, tails.n <span class="op">=</span> <span class="fl">50</span>,
       as.table <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="tutorial_files/figure-html/fdc-plot-1.png" alt="Log-normal Daily Flow Duration Curve for models in simulation." width="700"><p class="caption">
Log-normal Daily Flow Duration Curve for models in simulation.
</p>
</div>
<!-- Up to line 553 - Model and Calibration Options -->
<div class="section level2">
<h2 id="model-and-calibration-options">Model and Calibration Options<a class="anchor" aria-label="anchor" href="#model-and-calibration-options"></a>
</h2>
<p>There are several extensions to the basic model used so far. With different types of data, such as very dry or wet catchments, sub-daily time steps, poor areal rainfall estimates, cases of baseflow loss to groundwater, etc, different models or calibration methods will need to be used.</p>
<div class="section level3">
<h3 id="model-structure-and-parameter-ranges">Model Structure and Parameter Ranges<a class="anchor" aria-label="anchor" href="#model-structure-and-parameter-ranges"></a>
</h3>
<p>We have used an <code>ihacres()</code> CWI model in this tutorial, which is a simple metric type model. Other SMA models are included in the package, or one can define a new model. See the user manual for details.</p>
<p>Ranges of parameters to search when calibrating the effective rainfall model can be specified as arguments to the <strong>hydromad</strong> or <code><a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a></code> functions. Alternatively, parameters can be fixed to a given value by specifying a single number.</p>
<p>The default ranges can be seen, and set, using the function <code><a href="../reference/hydromad.options.html">hydromad.options()</a></code>.</p>
<p>The example, in the CWI model, the threshold parameter <code>l</code> (used for intermittent or ephemeral rivers), defaults to a fixed value of 0. To allow calibration of this parameter, specify a numerical range. Similarly, the evapo-transpiration coefficient <code>e</code> defaults to the range <span class="math inline">\([0.01,1.5]\)</span>; to fix it to a given value, just specify it:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/hydromad.html">hydromad</a></span><span class="op">(</span><span class="va">ts90s</span>, sma <span class="op">=</span> <span class="st">"cwi"</span>, l <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">200</span><span class="op">)</span>, e <span class="op">=</span> <span class="fl">0.166</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="optimisation-settings">Optimisation settings<a class="anchor" aria-label="anchor" href="#optimisation-settings"></a>
</h3>
<p>Each of the fitting functions has several options, and the help pages should be consulted for details. An important option is the choice of objective function; see the discussion above about how to specify it.</p>
<p>In the simple cases of using <code>fitBySampling</code> or <code>fitByOptim</code>, the argument <code>samples</code> specifies how many random parameter sets will be sampled (from the predefined parameter ranges), and argument <code>sampletype</code> chooses “Uniform Random”, “Latin Hypercube”, or “all combinations” (a regular grid of values). The one model with best objective function value is chosen. In the case of <code>fitByOptim</code> this is then improved locally with an optimisation algorithm.</p>
</div>
<div class="section level3">
<h3 id="unit-hydrograph-transfer-functions">Unit Hydrograph Transfer Functions<a class="anchor" aria-label="anchor" href="#unit-hydrograph-transfer-functions"></a>
</h3>
<p>A typical unit hydrograph model, at least in  models, is a linear <em>transfer function</em>, i.e. an ARMAX-like (Autoregressive, Moving Average, with eXogenous inputs). This can often, but not always, be formulated mathematically as a set of exponentially receding stores, which may be in a parallel and/or series configuration. ARMAX-type models are specified by the number of auto-regressive terms <span class="math inline">\(n\)</span> and the number of moving average terms <span class="math inline">\(m\)</span>. For example, a model with one store is <span class="math inline">\((n=1,m=0)\)</span>; two stores in parallel is <span class="math inline">\((n=2, m=1)\)</span>; two stores and an instantaneous store in parallel is <span class="math inline">\((n=2, m=2)\)</span>. Three stores in parallel is <span class="math inline">\((n=3,m=2)\)</span>.</p>
<p>When using <code>armax</code> or <code>expuh</code> routing, specialised methods are available to estimate for calibration, such as the <code>SRIV</code> (Simple Refined Instrumental Variable) algorithm. These are specified using the <code>rfit</code> argument.</p>
<p>The order of the transfer function may be varied, as well as the delay time. If there is any ambiguity in choosing the best delay time, each possibility should be tried.</p>
<p>To test different model structures systematically, a convenience function <code>tryModelOrders</code> is provided. An example is given in Table @ref(tab:try-model-orders-table). In this case a simple SMA is used with fixed parameters.</p>
<p>For more information on these issues see, for example, Jakeman et. al. (1990) and Young (2003).</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ihSpec</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/hydromad.html">hydromad</a></span><span class="op">(</span><span class="va">ts90s</span>, sma <span class="op">=</span> <span class="st">"cwi"</span>, tw <span class="op">=</span> <span class="fl">10</span>, f <span class="op">=</span> <span class="fl">1</span>, 
                   routing <span class="op">=</span> <span class="st">"armax"</span><span class="op">)</span>
<span class="va">osumm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/tryModelOrders.html">tryModelOrders</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">ihSpec</span>, rfit <span class="op">=</span> <span class="st">"sriv"</span><span class="op">)</span>,
                        n <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">3</span>, m <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">3</span>, delay <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">osumm</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>Fit and information statistics from fitting different unit hydrograph transfer functions with SRIV algorithm. ARPE is the Average Relative Parameter Error estimated by SRIV. The effective rainfall input was generated by an <code>ihacres</code> CWI model with fixed parameters.</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">ARPE</th>
<th align="right">r.squared</th>
<th align="right">r.sq.log</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">(n=0, m=0, d=0)</td>
<td align="right">0.000</td>
<td align="right">-5.432</td>
<td align="right">-2.421</td>
</tr>
<tr class="even">
<td align="left">(n=1, m=0, d=0)</td>
<td align="right">0.000</td>
<td align="right">0.545</td>
<td align="right">0.705</td>
</tr>
<tr class="odd">
<td align="left">(n=1, m=1, d=0)</td>
<td align="right">0.000</td>
<td align="right">0.671</td>
<td align="right">0.774</td>
</tr>
<tr class="even">
<td align="left">(n=2, m=0, d=0)</td>
<td align="right">0.015</td>
<td align="right">0.344</td>
<td align="right">0.550</td>
</tr>
<tr class="odd">
<td align="left">(n=2, m=1, d=0)</td>
<td align="right">0.001</td>
<td align="right">0.694</td>
<td align="right">0.782</td>
</tr>
<tr class="even">
<td align="left">(n=2, m=2, d=0)</td>
<td align="right">0.005</td>
<td align="right">0.698</td>
<td align="right">0.782</td>
</tr>
<tr class="odd">
<td align="left">(n=3, m=0, d=0)</td>
<td align="right">0.678</td>
<td align="right">0.605</td>
<td align="right">0.720</td>
</tr>
<tr class="even">
<td align="left">(n=3, m=1, d=0)</td>
<td align="right">0.023</td>
<td align="right">0.697</td>
<td align="right">0.782</td>
</tr>
<tr class="odd">
<td align="left">(n=3, m=2, d=0)</td>
<td align="right">28.994</td>
<td align="right">0.698</td>
<td align="right">0.782</td>
</tr>
<tr class="even">
<td align="left">(n=3, m=3, d=0)</td>
<td align="right">0.001</td>
<td align="right">0.705</td>
<td align="right">0.785</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="unit-hydrograph-inverse-fitting-methods">Unit Hydrograph Inverse Fitting Methods<a class="anchor" aria-label="anchor" href="#unit-hydrograph-inverse-fitting-methods"></a>
</h3>
<p>Unit Hydrograph routing models are typically fitted using least squares or SRIV algorithms, but this depends on the modelled effective rainfall, and so must be continuously re-fitted while calibrating the SMA model. One alternative is to fit the unit hydrograph to the observed streamflow data directly – though usually constrained by rainfall – and then use that as a fixed component while calibrating the SMA model. This can be done using an inverse filtering method with <code>rfit = list("inverse", ...)</code>. (There are many options here also).</p>
<p>Other such inverse fitting methods are possible, e.g. average event unit hydrograph estimation, but are not currently implemented in this package.</p>
</div>
<div class="section level3">
<h3 id="other-options">Other Options<a class="anchor" aria-label="anchor" href="#other-options"></a>
</h3>
<p>If model calibration is failing, you can set <code>hydromad.options(trace = TRUE)</code> and/or <code>hydromad.options(catch.errors = FALSE)</code> to track down what is happening.</p>
<p>It is sometimes useful to look at the model state variables, available as <code>predict(mod, return_state = TRUE)</code> (for the SMA model), or <code>predict(mod, return_components = TRUE)</code> (for the routing model), to see if they look sensible.</p>
<p>Some other things to try are</p>
<ul>
<li>using different calibration periods;<br>
</li>
<li>changing the warmup period length;<br>
</li>
<li>changing the optimisation method and/or settings.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="what-next">What Next?<a class="anchor" aria-label="anchor" href="#what-next"></a>
</h2>
<p>This document has described only a basic model fitting process.</p>
<!--An overview of the available models and options is given in the user
manual, which can be accessed as `vignette("hydromad")`.-->
<p>Help pages are available for most functions, and these are also available online at <a href="http://hydromad.catchment.org/" class="external-link">http://hydromad.catchment.org/</a>. There is also a set of demos: see <code>demo(package = "hydromad")</code> for a list.</p>
<p>Please discuss any problems or suggestions with the package maintainer.</p>
</div>
</div>
<div class="section level1">
<h1 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h1>
<div class="section level2">
<h2 id="reading-in-data">Reading in data<a class="anchor" aria-label="anchor" href="#reading-in-data"></a>
</h2>
<p>The required input data files for this tutorial are included with the <strong>hydromad</strong> package, in the <code>doc</code> directory. Note that the processed data is available directly in <code>R</code> – just type <code>data(Cotter)</code> – but this section shows how to read it in from text files as an exercise.</p>
<p>A few simple steps are required to import and convert the data into a usable form:<br>
- extracting dates from the files,<br>
- converting streamflow from ML/day to mm/day,<br>
- handling missing data values,<br>
- and aligning the three time series in a common time period.</p>
<p>Let’s first view the content of one of the input files. Set the working directory to where the data file is:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/file.show.html" class="external-link">file.show</a></span><span class="op">(</span><span class="st">"data/pq_cotter.csv"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## -99,49.8405,3/01/1964</span>
<span class="co">## -99,48.5998,4/01/1964</span>
<span class="co">## -99,46.3199,5/01/1964</span>
<span class="co">## -99,44.5028,6/01/1964</span>
<span class="co">## -99,41.9241,7/01/1964</span>
<span class="co">## ...</span></code></pre>
<p>There is no header in the file, but we know that the columns represent rainfall (P), streamflow (Q) and date of observation. The temperature file is similar. Knowing the format and columns we can use <code>read.table</code> to import the data:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## rain and flow data</span>
<span class="va">pqdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="st">"data/pq_cotter.csv"</span>, sep <span class="op">=</span> <span class="st">","</span>,
                    col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P"</span>, <span class="st">"Q"</span>, <span class="st">"Date"</span><span class="op">)</span>, as.is <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">## temperature data</span>
<span class="va">tdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="st">"data/t_cotter.csv"</span>, sep <span class="op">=</span> <span class="st">","</span>,
                   col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T"</span>, <span class="st">"Date"</span><span class="op">)</span>, as.is <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>and view the structure of the resulting data frames:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">pqdat</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## 'data.frame':    15339 obs. of  3 variables:</span>
<span class="co">##  $ P   : num  -99 -99 -99 -99 -99 -99 -99 -99 -99 -99 ...</span>
<span class="co">##  $ Q   : num  49.8 48.6 46.3 44.5 41.9 ...</span>
<span class="co">##  $ Date: chr  "3/01/1964" "4/01/1964" "5/01/1964" "6/01/1964" ...</span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">tdat</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## 'data.frame':    15467 obs. of  2 variables:</span>
<span class="co">##  $ T   : num  28.8 29.4 32.8 35.7 37.2 22.9 25.5 23.8 23.7 24.9 ...</span>
<span class="co">##  $ Date: chr  "3/01/1964" "4/01/1964" "5/01/1964" "6/01/1964" ...</span></code></pre>
<p>So far, the <code>Date</code> columns are only text; <code>R</code> does not know they are dates. We need to specify the date format, where <code>\%d</code> is day, <code>\%m</code> is month number, <code>\%b</code> is month name, <code>\%Y</code> is four-digit year and <code>\%y</code> is two-digit year (see <code><a href="https://rdrr.io/r/base/strptime.html" class="external-link">?strptime</a></code>).</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pqdat</span><span class="op">$</span><span class="va">Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">pqdat</span><span class="op">$</span><span class="va">Date</span>, <span class="st">"%d/%m/%Y"</span><span class="op">)</span>
<span class="va">tdat</span><span class="op">$</span><span class="va">Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">tdat</span><span class="op">$</span><span class="va">Date</span>, <span class="st">"%d/%m/%Y"</span><span class="op">)</span></code></pre></div>
<p>If the day, month and year were in separate columns of the file, with names <code>"day"</code>, <code>"mon"</code> and <code>"yr"</code> then you could do something like:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pqdat</span><span class="op">$</span><span class="va">Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">pqdat</span>, <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/yearmon.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ISOdatetime.html" class="external-link">ISOdate</a></span><span class="op">(</span><span class="va">yr</span>, <span class="va">mon</span>, <span class="va">day</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>If you have sub-daily time steps, a good choice is to use the <code>chron()</code> function from the <a href="https://cran.r-project.org/package=chron" class="external-link">chron</a> package to represent the time index.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<p>Negative values (-99) in the <em>pq</em> input file represent missing data; in <code>R</code> they should be set to the special value <code>NA</code>. Also, some dates in the temperature file are blank, and need to be removed.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pqdat</span><span class="op">$</span><span class="va">P</span><span class="op">[</span><span class="va">pqdat</span><span class="op">$</span><span class="va">P</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">pqdat</span><span class="op">$</span><span class="va">Q</span><span class="op">[</span><span class="va">pqdat</span><span class="op">$</span><span class="va">Q</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">tdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">tdat</span>, <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">Date</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The <strong>hydromad</strong> model fitting functions require that rainfall and streamflow are given in the same units, typically mm / day. The streamflow data in our input file is measured in ML / day, so we need to convert it, supplying the catchment area of 148 km<span class="math inline">\(^2\)</span>.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pqdat</span><span class="op">$</span><span class="va">Q</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/convertFlow.html">convertFlow</a></span><span class="op">(</span><span class="va">pqdat</span><span class="op">$</span><span class="va">Q</span>, from <span class="op">=</span> <span class="st">"ML"</span>, area.km2 <span class="op">=</span> <span class="fl">148</span><span class="op">)</span></code></pre></div>
<p>For simple applications, when the data series are already synchronised, this data frame (or matrix) format may be enough. However, there are benefits in working with actual <em>time series</em> objects: because they handle observation times, they allow powerful merging, treatment of missing values, rolling averages and other functions. While <code>R</code> has a built-in structure for regular time series (<code>ts</code>), these do not handle specific dates or times, only index numbers. It is recommended to work with <code>zoo</code> objects (using the <a href="https://cran.r-project.org/package=zoo" class="external-link">zoo</a> package).^[<a href="https://cran.r-project.org/package=zoo" class="external-link">zoo</a> objects are a generalisation of <code>ts</code> objects and in many cases can be used in the same way; see <code><a href="https://cran.rstudio.com/web/packages/zoo/vignettes/zoo.pdf" class="external-link">vignette("zoo")</a></code>.}</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://zoo.R-Forge.R-project.org/" class="external-link">zoo</a></span><span class="op">)</span>
<span class="va">tsPQ</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/zoo.html" class="external-link">zoo</a></span><span class="op">(</span><span class="va">pqdat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span>, <span class="va">pqdat</span><span class="op">$</span><span class="va">Date</span>, frequency <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="va">tsT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/zoo.html" class="external-link">zoo</a></span><span class="op">(</span><span class="va">tdat</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">tdat</span><span class="op">$</span><span class="va">Date</span>, frequency <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>We can now merge the time series together into a final dataset. Note that the <strong>hydromad</strong> package expects temperature or evapo-transpiration data to be called <code>E</code>, not <code>T</code>. <a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Cotter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">tsPQ</span>, E <span class="op">=</span> <span class="va">tsT</span>, all <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>Print the first few rows (the <em>head</em>) of the time series, to check that everything looks OK:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">Cotter</span>, <span class="fl">6</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##             P         Q    E</span>
<span class="co">## 1964-01-03 NA 0.3367601 28.8</span>
<span class="co">## 1964-01-04 NA 0.3283770 29.4</span>
<span class="co">## 1964-01-05 NA 0.3129723 32.8</span>
<span class="co">## 1964-01-06 NA 0.3006946 35.7</span>
<span class="co">## 1964-01-07 NA 0.2832709 37.2</span>
<span class="co">## 1964-01-08 NA 0.2909014 22.9</span></code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/time.html" class="external-link">time</a></span><span class="op">(</span><span class="va">Cotter</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "1964-01-03" "2005-12-31"</span></code></pre>
<p>This shows that the rainfall data has missing values at the beginning. At the other end of the series, Streamflow data is missing. This will not cause a problem, but let us tidy it up anyway:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Cotter</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/zoo/man/na.trim.html" class="external-link">na.trim</a></span><span class="op">(</span><span class="va">Cotter</span><span class="op">)</span></code></pre></div>
<p>The final dataset extends from 1966-05-01 to 2003-06-12, and is shown in Figure @ref(fig:dataplot) and Table @ref(tab:datasummary):</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">Cotter</span><span class="op">)</span></code></pre></div>
<table class="table">
<caption>Data summary. P = precipitation (mm/day), E = temperature (deg. C), Q = streamflow (mm/day).</caption>
<thead><tr class="header">
<th align="left"></th>
<th align="right">P</th>
<th align="right">Q</th>
<th align="right">E</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Min.</td>
<td align="right">0.000000</td>
<td align="right">0.0050657</td>
<td align="right">2.80000</td>
</tr>
<tr class="even">
<td align="left">1st Qu.</td>
<td align="right">0.000000</td>
<td align="right">0.2273834</td>
<td align="right">14.00000</td>
</tr>
<tr class="odd">
<td align="left">Median</td>
<td align="right">0.000000</td>
<td align="right">0.4836848</td>
<td align="right">19.20000</td>
</tr>
<tr class="even">
<td align="left">Mean</td>
<td align="right">2.965781</td>
<td align="right">0.8268533</td>
<td align="right">19.69359</td>
</tr>
<tr class="odd">
<td align="left">3rd Qu.</td>
<td align="right">1.650000</td>
<td align="right">1.0391858</td>
<td align="right">24.60000</td>
</tr>
<tr class="even">
<td align="left">Max.</td>
<td align="right">141.390000</td>
<td align="right">28.4952703</td>
<td align="right">42.20000</td>
</tr>
<tr class="odd">
<td align="left">NA’s</td>
<td align="right">0.000000</td>
<td align="right">33.0000000</td>
<td align="right">0.00000</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level1">
<h1 id="computational-details">Computational details<a class="anchor" aria-label="anchor" href="#computational-details"></a>
</h1>
<p>The results in this paper were obtained using <code>R</code> 4.1.2 with the packages <strong>hydromad</strong> 0.9–27, <code>zoo</code> 1.8–9 and <code>latticeExtra</code> 0.6–29. <code>R</code> itself and all packages used are (or will be) available from CRAN at <a href="http://CRAN.R-project.org/" class="external-link">http://CRAN.R-project.org/</a>.</p>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>for more complex structures <code>v_3</code> and/or <code>v_q</code> may be specified. See the help page for details.<a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>There is a time class built into <code>R</code>, called <code>POSIXct</code>, but this represents time zones which can sometimes lead to complications.<a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>This avoids name conflicts since in <code>R</code>,<code>T</code> is a shorthand for <code>TRUE</code>.<a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Joseph Guillaume.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
