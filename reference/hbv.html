<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>HBV rainfall-runoff model — hbv • hydromad</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="HBV rainfall-runoff model — hbv"><meta property="og:description" content="An implementation of the HBV rainfall-runoff model."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hydromad</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9-27</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/hydromad.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/tutorial.html">Tutorial</a>
    </li>
    <li>
      <a href="../articles/hbv.html">HBV model</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li class="dropdown-header">Releases</li>
    <li>
      <a href="http://github.com/josephguillaume/hydromad" class="external-link">hydromad 0.9-27</a>
    </li>
    <li class="divider">
    <li>
      <a href="../news/index.html">Changelog</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/josephguillaume/hydromad/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>HBV rainfall-runoff model</h1>
    <small class="dont-index">Source: <a href="https://github.com/josephguillaume/hydromad/blob/HEAD/R/hbv.R" class="external-link"><code>R/hbv.R</code></a></small>
    <div class="hidden name"><code>hbv.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>An implementation of the HBV rainfall-runoff model.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">hbv.sim</span><span class="op">(</span>
  <span class="va">DATA</span>,
  <span class="va">tt</span>,
  <span class="va">cfmax</span>,
  <span class="va">sfcf</span>,
  <span class="va">cfr</span>,
  <span class="va">cwh</span>,
  <span class="va">fc</span>,
  <span class="va">lp</span>,
  <span class="va">beta</span>,
  <span class="va">cet</span>,
  return_state <span class="op">=</span> <span class="cn">FALSE</span>,
  initialise_sm <span class="op">=</span> <span class="cn">FALSE</span>,
  <span class="va">PET</span>
<span class="op">)</span>

<span class="fu">hbvrouting.sim</span><span class="op">(</span>
  <span class="va">U</span>,
  <span class="va">perc</span>,
  <span class="va">uzl</span>,
  <span class="va">k0</span>,
  <span class="va">k1</span>,
  <span class="va">k2</span>,
  <span class="va">maxbas</span>,
  initial_slz <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>,
  epsilon <span class="op">=</span> <span class="fu"><a href="hydromad.options.html">hydromad.getOption</a></span><span class="op">(</span><span class="st">"sim.epsilon"</span><span class="op">)</span>,
  return_components <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span>

<span class="fu">hbv.ranges</span><span class="op">(</span><span class="op">)</span>

<span class="fu">hbvrouting.ranges</span><span class="op">(</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>DATA</dt>
<dd><p>A time-series like object with columns P (precipitation in mm),
T (average air temperature in ºC) and E (potential
evapotranspiration in mm). If E is not supplied then the PET argument must
be used.</p></dd>
<dt>tt</dt>
<dd><p>Threshold temperature for snow and snow melt in degrees Celsius.</p></dd>
<dt>cfmax</dt>
<dd><p>Degree-day factor for snow melt (mm/(ºC.day)).</p></dd>
<dt>sfcf</dt>
<dd><p>Snowfall correction factor. Amount of precipitation below
threshold temperature that should be rainfall instead of snow.</p></dd>
<dt>cfr</dt>
<dd><p>Refreezing coefficient for water in the snowpack.</p></dd>
<dt>cwh</dt>
<dd><p>Liquid water holding capacity of the snowpack.</p></dd>
<dt>fc</dt>
<dd><p>Maximum amount of soil moisture storage (mm).</p></dd>
<dt>lp</dt>
<dd><p>Threshold for reduction of evaporation. Limit for potential
evapotranspiration.</p></dd>
<dt>beta</dt>
<dd><p>Shape coefficient in soil routine.</p></dd>
<dt>cet</dt>
<dd><p>Potential ET correction factor. Optional if a full PET series
is provided.</p></dd>
<dt>return_state</dt>
<dd><p>Whether to return the state variables.</p></dd>
<dt>initialise_sm</dt>
<dd><p>If true, the soil moisture store is initialised to
equal <code>fc</code>*<code>lp</code> to match HBVlight behaviour. Defaults to false.</p></dd>
<dt>PET</dt>
<dd><p>A list containing named objects "PET" and optionally "Tmean".
PET and Tmean must be vectors of length 12 or 365 that represent mean values.
Optional if <code>E</code> is supplied in <code>DATA</code>. If supplied then <code>cet</code> must be
parameterised.</p></dd>
<dt>U</dt>
<dd><p>Effective rainfall series/recharge series.</p></dd>
<dt>perc</dt>
<dd><p>Maximum percolation from upper to lower groundwater storage.</p></dd>
<dt>uzl</dt>
<dd><p>Threshold for quick runoff for k0 outflow (mm).</p></dd>
<dt>k0</dt>
<dd><p>Recession coefficient (quick runoff).</p></dd>
<dt>k1</dt>
<dd><p>Recession coefficient (upper groundwater storage).</p></dd>
<dt>k2</dt>
<dd><p>Recession coefficient (lower groundwater storage).</p></dd>
<dt>maxbas</dt>
<dd><p>Routing, length of triangular weighting function (days).</p></dd>
<dt>initial_slz</dt>
<dd><p>Initial value for the lower store (SLZ). Defaults to 0.</p></dd>
<dt>epsilon</dt>
<dd><p>Values smaller than this in the output will be set to zero.</p></dd>
<dt>return_components</dt>
<dd><p>Whether to return state variables from the routing
routine.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>The timeseries of simulated streamflow (U). If return state is set
to true, the state variables of the model are also returned. These include:
snow depth (Snow), soil moisture (SM), potential evapotranspiration (PET)
and actual evapotranspiration (AET), .
For hbv_routing, the routed effective rainfall series (X) is returned. If
return components is to true, the state variables of the routing model are
returned: upper groundwater storage (SUZ), lower groundwater storage (SLZ),
runoff from quick flow (Q0), upper groundwater (Q1) and lower groundwater
(Q2).
Default parameter ranges are guided by Seibert (1997) and Seibert and Vis
(2012) and (see the references section). Parameter ranges for your
catchment may require either a more restricted or wider range.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This implementation of this HBV model closely follows the
description of HBV light by Seibert and Vis, 2012. Daily average temperature
data is required for the snow routine. If daily potential evapotranspiration
(PET) data is not provided in <code>DATA</code>, then the PET is estimated using the
HBV method and the <code>PET</code> and <code>cet</code> arguments must be specified. The list
needs to contain a vector named <code>"PET"</code> containing daily average (or matching
the timestep of <code>DATA</code>) values of length 12 (monthly) or 365 (days of year).
<code>"Tmean"</code> can also be provided in this list, of length 12 or 365, otherwise
average monthly values will be calculated from the average temperature
series in <code>DATA</code>. See an example below of how to pass average values.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Bergström, S. and Forsman, A.: Development of a Conceptual Deterministic
Rainfall-Runoff Model, Nordic Hydrology, 4(3), 147–170, 1973.</p>
<p>Bergström, S.: The HBV Model: Its Structure and Applications,Swedish
Meteorological and Hydrological Institute (SMHI), Hydrology, Norrköping, 35
pp., 1992.</p>
<p>Seibert, J. (1997). Estimation of Parameter Uncertainty in the HBV Model.
Hydrology Research, 28(4–5), 247–262.</p>
<p>Seibert, J. and Vis, M. (2012). Teaching hydrological modeling with a
user-friendly catchment-runoff-model software package. Hydrology and Earth
System Sciences, 16, 3315–3325, 2012.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code>hydromad(sma='hbv', routing='hbvrouting')</code> to work with
models as objects (recommended).</p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Alexander Buzacott (abuz5257@uni.sydney.edu.au)</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># Using example dataset Corin with daily P, Q, potential ET and average T</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Corin</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># See default par ranges with hbv.ranges() or hydromad.getOption('hbv')</span></span>
<span class="r-in"><span class="fu"><a href="hydromad.options.html">hydromad.getOption</a></span><span class="op">(</span><span class="st">"hbv"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $tt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -2.5  2.5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $cfmax</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  1 10</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $sfcf</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.4 1.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $cfr</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.0 0.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $cwh</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.0 0.2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $fc</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  50 500</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $lp</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.3 1.0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $beta</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 6</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span class="fu"><a href="hydromad.options.html">hydromad.getOption</a></span><span class="op">(</span><span class="st">"hbvrouting"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $perc</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0 3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $uzl</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]   0 100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $k0</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.05 0.50</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $k1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.01 0.30</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $k2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.001 0.100</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $maxbas</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Create model</span></span>
<span class="r-in"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="hydromad.html">hydromad</a></span><span class="op">(</span></span>
<span class="r-in">  DATA <span class="op">=</span> <span class="va">Corin</span>,</span>
<span class="r-in">  sma <span class="op">=</span> <span class="st">"hbv"</span>,</span>
<span class="r-in">  routing <span class="op">=</span> <span class="st">"hbvrouting"</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Fit using the optim routine with the KGE objective function</span></span>
<span class="r-in"><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="fitByOptim.html">fitByOptim</a></span><span class="op">(</span><span class="va">mod</span>, objective <span class="op">=</span> <span class="fu"><a href="hydromad.stats.html">hmadstat</a></span><span class="op">(</span><span class="st">"KGE"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Summary statistics and plot of the fit</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hydromad(DATA = Corin, sma = "hbv", routing = "hbvrouting", perc = 2.9511, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     uzl = 37.6806, k0 = 0.20834, k1 = 0.198619, k2 = 0.0644331, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     maxbas = 1.62593, tt = -1.41364, cfmax = 5.18182, sfcf = 0.921212, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     cfr = 0.0383838, cwh = 0.165657, fc = 277.659, lp = 0.933893, </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     beta = 2.89523)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Time steps: 1361 (0 missing).</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Runoff ratio (Q/P): (0.4495 / 2.315) = 0.1942</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> rel bias: -0.000367</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> r squared: 0.9172</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> r sq sqrt: 0.8991</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> r sq log: 0.8228</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> For definitions see ?hydromad.stats</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span class="fu"><a href="objFunVal.html">objFunVal</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.9203671</span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/pkg/lattice/man/xyplot.html" class="external-link">xyplot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span class="r-plt img"><img src="hbv-1.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># If using average values of PET and Tmean if daily values of PET are not</span></span>
<span class="r-in"><span class="co"># available and E is not in DATA. cet must be specified.</span></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="hydromad.html">hydromad</a></span><span class="op">(</span></span>
<span class="r-in">  DATA <span class="op">=</span> <span class="va">Corin</span>,</span>
<span class="r-in">  sma <span class="op">=</span> <span class="st">"hbv"</span>,</span>
<span class="r-in">  routing <span class="op">=</span> <span class="st">"hbvrouting"</span>,</span>
<span class="r-in">  PET <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"PET"</span> <span class="op">=</span> <span class="va">PET</span>, <span class="st">"Tmean"</span> <span class="op">=</span> <span class="va">Tmean</span><span class="op">)</span>,</span>
<span class="r-in">  cet <span class="op">=</span> <span class="fl">0.1</span></span>
<span class="r-in"><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Joseph Guillaume.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

