<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Extract the feasible parameter sets meeting some criteria. — defineFeasibleSet • hydromad</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Extract the feasible parameter sets meeting some criteria. — defineFeasibleSet" />
<meta property="og:description" content="Extract the feasible (or behavioural) parameter sets meeting some
criteria. These could be used as a feasible set or to estimate prediction
quantiles according to the GLUE (Generalised Likelihood Uncertainty
Estimation) method." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hydromad</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9-26</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/hydromad.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/tutorial.html">Tutorial</a>
    </li>
    <li>
      <a href="../articles/hbv.html">HBV model</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Releases</li>
    <li>
      <a href="http://github.com/josephguillaume/hydromad">hydromad 0.9-27</a>
    </li>
    <li class="divider"></li>
    <li>
      <a href="../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/josephguillaume/hydromad/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Extract the feasible parameter sets meeting some criteria.</h1>
    <small class="dont-index">Source: <a href='https://github.com/josephguillaume/hydromad/blob/master/R/defineFeasibleSet.R'><code>R/defineFeasibleSet.R</code></a></small>
    <div class="hidden name"><code>defineFeasibleSet.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Extract the feasible (or <em>behavioural</em>) parameter sets meeting some
criteria. These could be used as a feasible set or to estimate prediction
quantiles according to the GLUE (Generalised Likelihood Uncertainty
Estimation) method.</p>
    </div>

    <pre class="usage"><span class='fu'>defineFeasibleSet</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span><span class='op'>)</span>

<span class='co'># S3 method for hydromad</span>
<span class='fu'>defineFeasibleSet</span><span class='op'>(</span><span class='va'>x</span>, <span class='va'>...</span>, thin <span class='op'>=</span> <span class='cn'>NA</span><span class='op'>)</span>

<span class='co'># S3 method for default</span>
<span class='fu'>defineFeasibleSet</span><span class='op'>(</span>
  <span class='va'>x</span>,
  <span class='va'>model</span>,
  objseq <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/rep.html'>rep</a></span><span class='op'>(</span><span class='fl'>1</span>, <span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>NROW</a></span><span class='op'>(</span><span class='va'>x</span><span class='op'>)</span><span class='op'>)</span>,
  frac.within <span class='op'>=</span> <span class='fl'>0</span>,
  within.rel <span class='op'>=</span> <span class='fl'>0.01</span>,
  within.abs <span class='op'>=</span> <span class='fl'>0.1</span>,
  groups <span class='op'>=</span> <span class='cn'>NULL</span>,
  FUN <span class='op'>=</span> <span class='va'>sum</span>,
  target.coverage <span class='op'>=</span> <span class='fl'>1</span>,
  threshold <span class='op'>=</span> <span class='op'>-</span><span class='cn'>Inf</span>,
  glue.quantiles <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>1</span><span class='op'>)</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>in the <code>hydromad</code> method this is a <code><a href='hydromad.html'>hydromad</a></code>
model object which has been run through either <code><a href='fitBySampling.html'>fitBySampling</a></code>
or <code><a href='fitByDream.html'>fitByDream</a></code> to generate a large number of random parameter
sets with associated objective function scores.  In the <code>default</code>
method, the first argument (<code>x</code>) is a matrix of parameter values
corresponding to the objective function values <code>objseq</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>extra arguments to the <code>hydromad</code> method are passed on to
the <code>default</code> method. Extra arguments to the <code>default</code> method will
result in an error.</p></td>
    </tr>
    <tr>
      <th>thin</th>
      <td><p>interval between samples for results from DREAM.  As it is a
Markov Chain Monte Carlo method, the sequences should be thinned first to
remove autocorrelation and achieve an efficient sample of the parameter
distributions. The default thinning interval <code>NA</code> uses the empirical
autocorrelation.  See <code>window.mcmc</code>.</p></td>
    </tr>
    <tr>
      <th>model</th>
      <td><p>the <code>hydromad</code> model object to be used to run simulations.
Does not apply to the <code>hydromad</code> method.</p></td>
    </tr>
    <tr>
      <th>objseq</th>
      <td><p>objective function values corresponding to the parameter sets
<code>x</code>. This does not apply to the <code>hydromad</code> method, where it is
assumed that the objective function values have already been calculated.
Note that <code>objseq</code> can be omitted if not using the
<code>target.coverage</code> or <code>threshold</code> arguments (i.e. if just defining
an error criterion with <code>frac.within, within.rel, within.abs</code>), so the
original simulation run is not necessary.</p></td>
    </tr>
    <tr>
      <th>frac.within, within.abs, within.rel</th>
      <td><p>model simulations are only retained
in the feasible set if some fraction <code>frac.within</code> of the simulated
values are within a fraction <code>within.rel</code> of the observed values OR
within an absolute difference of <code>within.abs</code> (typically mm/day).</p></td>
    </tr>
    <tr>
      <th>groups, FUN</th>
      <td><p><code>groups</code> is an optional grouping variable, of the
same length as the observed data in <code>model</code>, used to aggregate the
observed and fitted time series. The function <code>FUN</code> is applied to each
group. In this case, the error criteria <code>frac.within, within.rel,
within.abs</code> are evaluated on the aggregated values, not the raw time series.
Also <code>target.coverage</code> applies to the aggregated values.  Typically
<code>groups</code> would be generated by <code><a href='https://rdrr.io/r/base/cut.POSIXt.html'>cut.Date</a></code> (for regular time
periods) or <code><a href='events.html'>eventseq</a></code> (for events).  Note that the
<code>feasible.bounds</code> (e.g. for plotting) in this case will be an
aggregated time series, it will not correspond to the original time index.
Use <code>update</code> or <code>predict</code> to generate bounds on the original time
index.</p></td>
    </tr>
    <tr>
      <th>target.coverage</th>
      <td><p>fraction of the observed values to be contained
within the overall ranges of simulated values (minimum and maximum on each
time step) from the feasible set of parameters. Note, this does not refer to
the <code>glue.quantiles</code> values, but to the overall maximum and minimum.
The simulated values can be within the tolerance limit of observed values
given by <code>within.abs</code> to count as coverage.</p></td>
    </tr>
    <tr>
      <th>threshold</th>
      <td><p>value of the objective function (the objective function
used to generate <code>objseq</code>) used to define the feasible set: all
parameter sets above this threshold value will be kept.  Also this
<code>threshold</code> value is subtracted from the objective function values to
calculate weights when <code>glue.quantiles</code> is given. If left as
<code>-Inf</code>, it will be set to the minimum objective function value in the
final feasible set.</p></td>
    </tr>
    <tr>
      <th>glue.quantiles</th>
      <td><p>if specified, these GLUE quantiles of the ensemble
simulations will be calculated and stored. They can be extracted with
<code>fitted</code> and shown in <code>xyplot</code>. The quantiles are calcualted using
the <code><a href='https://rdrr.io/pkg/Hmisc/man/wtd.stats.html'>wtd.quantile</a></code> function, and weighted according to
<code>objseq</code> - <code>threshold</code>. If <code>glue.quantiles</code> is left as
<code><a href='https://rdrr.io/r/base/c.html'>c(0,1)</a></code> then the overall minimum and maximum simulated values are
taken on each time step, which is faster.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>a modified version of <code>model</code>, with added elements
<code>feasible.set</code>, <code>feasible.scores</code>, <code>feasible.fitted</code>,
<code>glue.quantiles</code> and <code>feasible.threshold</code>.  Can be passed to
<code>xyplot</code>, <code>fitted</code>, <code>predict</code>, <code>update</code>, <code>coef</code>,
and <code>print</code>.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='predict.hydromad.html'>predict.hydromad</a></code>, <code>update.hydromad</code>,
<code><a href='fitBySampling.html'>fitBySampling</a></code>, <code><a href='fitByDream.html'>fitByDream</a></code></p></div>
    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Felix Andrews <a href='mailto:felix@nfrac.org'>felix@nfrac.org</a></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>Queanbeyan</span><span class='op'>)</span>
<span class='va'>ts74</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/window.html'>window</a></span><span class='op'>(</span><span class='va'>Queanbeyan</span>, start <span class='op'>=</span> <span class='st'>"1974-01-01"</span>, end <span class='op'>=</span> <span class='st'>"1976-12-01"</span><span class='op'>)</span>
<span class='va'>mod</span> <span class='op'>&lt;-</span> <span class='fu'><a href='hydromad.html'>hydromad</a></span><span class='op'>(</span><span class='va'>ts74</span>, routing <span class='op'>=</span> <span class='st'>"expuh"</span>, rfit <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='st'>"inverse"</span>, order <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>2</span>, <span class='fl'>1</span><span class='op'>)</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>mod</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span><span class='op'>(</span><span class='va'>mod</span>,
  sma <span class='op'>=</span> <span class='st'>"cwi"</span>,
  tw <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>100</span><span class='op'>)</span>, f <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0</span>, <span class='fl'>8</span><span class='op'>)</span>, loss <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='op'>-</span><span class='fl'>0.1</span>, <span class='fl'>0.1</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='co'>## Calculate the set of simulations within 15% error (or 1 mm/day) 90% of time.</span>
<span class='co'>## In this case we do not need to calculate objective function values</span>
<span class='co'>## beforehand. For GLUE quantiles, however, need to give 'objective'.</span>
<span class='va'>psets</span> <span class='op'>&lt;-</span> <span class='fu'><a href='parameterSets.html'>parameterSets</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>mod</span><span class='op'>)</span>, samples <span class='op'>=</span> <span class='fl'>300</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='warning'>Warning: parameters not fully specified, returning list</span></div><div class='input'><span class='va'>feas</span> <span class='op'>&lt;-</span> <span class='fu'>defineFeasibleSet</span><span class='op'>(</span><span class='va'>psets</span>,
  model <span class='op'>=</span> <span class='va'>mod</span>,
  frac.within <span class='op'>=</span> <span class='fl'>0.9</span>, within.rel <span class='op'>=</span> <span class='fl'>0.15</span>, within.abs <span class='op'>=</span> <span class='fl'>1</span>
<span class='op'>)</span>

<span class='co'>## How many of the 300 possible parameter sets were retained?</span>
<span class='fu'><a href='https://rdrr.io/r/base/nrow.html'>nrow</a></span><span class='op'>(</span><span class='fu'><a href='https://rdrr.io/r/stats/coef.html'>coef</a></span><span class='op'>(</span><span class='va'>feas</span>, feasible.set <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 111</div><div class='input'>
<span class='co'>## View ranges of parameters in feasible set</span>
<span class='va'>feas</span>
</div><div class='output co'>#&gt; 
#&gt; Hydromad model with "cwi" SMA and "expuh" routing:
#&gt; Start = 1974-01-01, End = 1976-12-01
#&gt; 
#&gt; SMA Parameters:
#&gt;       lower upper     
#&gt; tw        0   100     
#&gt; f         0     8     
#&gt; scale    NA    NA     
#&gt; l         0     0 (==)
#&gt; p         1     1 (==)
#&gt; t_ref    20    20 (==)
#&gt; Routing Parameters:
#&gt;         lower   upper     
#&gt; tau_s 13.0292 13.0292 (==)
#&gt; tau_q  0.5728  0.5728 (==)
#&gt; v_s    0.4433  0.4433 (==)
#&gt; v_q    0.5567  0.5567 (==)
#&gt; delay  1.0000  1.0000 (==)
#&gt; loss  -0.1000  0.1000     
#&gt; Feasible parameter set:
#&gt;          tw f scale l p t_ref tau_s  tau_q    v_s    v_q delay     loss
#&gt; lower  0.00 0    NA 0 1    20 13.03 0.5728 0.4433 0.5567     1 -0.09933
#&gt; upper 97.66 8    NA 0 1    20 13.03 0.5728 0.4433 0.5567     1  0.10000
#&gt; 
#&gt; Routing fit info:  list(TRUE, 2) </div><div class='input'>
<span class='co'>## Plot simulation bounds</span>
<span class='fu'>xyplot</span><span class='op'>(</span><span class='va'>feas</span>, feasible.bounds <span class='op'>=</span> <span class='cn'>TRUE</span>, cut <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
</div><div class='img'><img src='defineFeasibleSet-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'>## Generate set of simulations with NSE &gt; 0.5, for GLUE.</span>
<span class='co'>## First, need to calculate objective function values:</span>
<span class='va'>fit</span> <span class='op'>&lt;-</span> <span class='fu'><a href='fitBySampling.html'>fitBySampling</a></span><span class='op'>(</span><span class='va'>mod</span>, samples <span class='op'>=</span> <span class='fl'>300</span>, objective <span class='op'>=</span> <span class='fu'><a href='hydromad.stats.html'>hmadstat</a></span><span class='op'>(</span><span class='st'>"r.squared"</span><span class='op'>)</span><span class='op'>)</span>
<span class='co'>## Calculate 5 percent and 95 percent GLUE quantiles (i.e. weighted).</span>
<span class='va'>fitglu</span> <span class='op'>&lt;-</span> <span class='fu'>defineFeasibleSet</span><span class='op'>(</span><span class='va'>fit</span>,
  threshold <span class='op'>=</span> <span class='fl'>0.5</span>,
  glue.quantiles <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.05</span>, <span class='fl'>0.95</span><span class='op'>)</span>
<span class='op'>)</span>
<span class='co'>## Coverage of the GLUE quantile simulations (within 0.1 mm/day)</span>
<span class='va'>sim</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/fitted.values.html'>fitted</a></span><span class='op'>(</span><span class='va'>fitglu</span>, feasible.bounds <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span><span class='op'>(</span><span class='va'>sim</span><span class='op'>)</span>
</div><div class='output co'>#&gt;               GLUE.5   GLUE.95
#&gt; 1974-04-11 4.9134569 15.603560
#&gt; 1974-04-12 3.9902576 12.379516
#&gt; 1974-04-13 1.8160592  5.819653
#&gt; 1974-04-14 1.7512514  5.715896
#&gt; 1974-04-15 1.0651009  3.628814
#&gt; 1974-04-16 0.7150688  2.528074</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>sim</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fu'><a href='utilities.html'>observed</a></span><span class='op'>(</span><span class='va'>fitglu</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>0.1</span><span class='op'>)</span> <span class='op'>&amp;</span>
  <span class='op'>(</span><span class='va'>sim</span><span class='op'>[</span>, <span class='fl'>2</span><span class='op'>]</span> <span class='op'>&gt;</span> <span class='fu'><a href='utilities.html'>observed</a></span><span class='op'>(</span><span class='va'>fitglu</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.8964803</div><div class='input'>
<span class='co'>## Or - keep adding parameter sets until we reach a target coverage:</span>
<span class='co'>## Calculate 5 percent and 95 percent GLUE quantiles (i.e. weighted).</span>
<span class='va'>fitglu</span> <span class='op'>&lt;-</span> <span class='fu'>defineFeasibleSet</span><span class='op'>(</span><span class='va'>fit</span>,
  target.coverage <span class='op'>=</span> <span class='fl'>0.9</span>,
  glue.quantiles <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.05</span>, <span class='fl'>0.95</span><span class='op'>)</span>
<span class='op'>)</span>
<span class='co'>## Coverage of the GLUE quantile simulations (within 0.1 mm/day)</span>
<span class='co'>## (not to be confused with the target.coverage to define overall feasible set)</span>
<span class='va'>sim</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/fitted.values.html'>fitted</a></span><span class='op'>(</span><span class='va'>fitglu</span>, feasible.bounds <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>sim</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fu'><a href='utilities.html'>observed</a></span><span class='op'>(</span><span class='va'>fitglu</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>0.1</span><span class='op'>)</span> <span class='op'>&amp;</span>
  <span class='op'>(</span><span class='va'>sim</span><span class='op'>[</span>, <span class='fl'>2</span><span class='op'>]</span> <span class='op'>&gt;</span> <span class='fu'><a href='utilities.html'>observed</a></span><span class='op'>(</span><span class='va'>fitglu</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.800207</div><div class='input'>
<span class='co'>## Plot simulated GLUE quantiles</span>
<span class='fu'>xyplot</span><span class='op'>(</span><span class='va'>fitglu</span>, feasible.bounds <span class='op'>=</span> <span class='cn'>TRUE</span>, cut <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
</div><div class='img'><img src='defineFeasibleSet-2.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'>xyplot</span><span class='op'>(</span><span class='va'>fitglu</span>,
  feasible.bounds <span class='op'>=</span> <span class='cn'>TRUE</span>, cut <span class='op'>=</span> <span class='fl'>3</span>,
  scales <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>y <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span>log <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span><span class='op'>)</span>
<span class='op'>)</span>
</div><div class='img'><img src='defineFeasibleSet-3.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'>## Summarise size of the simulation bounds: lower as fraction of upper</span>
<span class='fu'><a href='https://rdrr.io/r/base/summary.html'>summary</a></span><span class='op'>(</span><span class='fu'>coredata</span><span class='op'>(</span><span class='va'>sim</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span> <span class='op'>/</span> <span class='va'>sim</span><span class='op'>[</span>, <span class='fl'>2</span><span class='op'>]</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#&gt;  0.0000  0.1608  0.2364  0.2600  0.3643  0.8062 </div><div class='input'>
<span class='co'>## Simulate on a new data period</span>
<span class='va'>newglu</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/update.html'>update</a></span><span class='op'>(</span><span class='va'>fitglu</span>,
  newdata <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/stats/window.html'>window</a></span><span class='op'>(</span><span class='va'>Queanbeyan</span>,
    start <span class='op'>=</span> <span class='st'>"1980-01-01"</span>, end <span class='op'>=</span> <span class='st'>"1982-01-01"</span>
  <span class='op'>)</span>,
  glue.quantiles <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>0.05</span>, <span class='fl'>0.95</span><span class='op'>)</span>
<span class='op'>)</span>
<span class='co'>## The new period is very dry, all model simulations overestimate flow.</span>
<span class='fu'>xyplot</span><span class='op'>(</span><span class='va'>newglu</span>, feasible.bounds <span class='op'>=</span> <span class='cn'>TRUE</span>, cut <span class='op'>=</span> <span class='fl'>3</span><span class='op'>)</span>
</div><div class='img'><img src='defineFeasibleSet-4.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'>## Coverage of the GLUE quantile simulations (within 0.1 mm/day)</span>
<span class='va'>sim</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/fitted.values.html'>fitted</a></span><span class='op'>(</span><span class='va'>newglu</span>, feasible.bounds <span class='op'>=</span> <span class='cn'>TRUE</span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/base/mean.html'>mean</a></span><span class='op'>(</span><span class='op'>(</span><span class='va'>sim</span><span class='op'>[</span>, <span class='fl'>1</span><span class='op'>]</span> <span class='op'>&lt;</span> <span class='fu'><a href='utilities.html'>observed</a></span><span class='op'>(</span><span class='va'>newglu</span><span class='op'>)</span> <span class='op'>+</span> <span class='fl'>0.1</span><span class='op'>)</span> <span class='op'>&amp;</span>
  <span class='op'>(</span><span class='va'>sim</span><span class='op'>[</span>, <span class='fl'>2</span><span class='op'>]</span> <span class='op'>&gt;</span> <span class='fu'><a href='utilities.html'>observed</a></span><span class='op'>(</span><span class='va'>newglu</span><span class='op'>)</span> <span class='op'>-</span> <span class='fl'>0.1</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 0.6977848</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Joseph Guillaume.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


