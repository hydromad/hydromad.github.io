<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Statistics for use in hydromad — hydromad.stats • hydromad</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Statistics for use in hydromad — hydromad.stats"><meta property="og:description" content="These functions provide access to a built-in set of statistics, and also
allow the user to change or add named statistics.  Its usage is similar to
hydromad.options."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hydromad</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9-27</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/hydromad.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/tutorial.html">Tutorial</a>
    </li>
    <li>
      <a href="../articles/hbv.html">HBV model</a>
    </li>
  </ul></li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li class="dropdown-header">Releases</li>
    <li>
      <a href="http://github.com/josephguillaume/hydromad" class="external-link">hydromad 0.9-27</a>
    </li>
    <li class="divider">
    <li>
      <a href="../news/index.html">Changelog</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/josephguillaume/hydromad/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Statistics for use in hydromad</h1>
    <small class="dont-index">Source: <a href="https://github.com/josephguillaume/hydromad/blob/HEAD/R/hydromad.stats.R" class="external-link"><code>R/hydromad.stats.R</code></a></small>
    <div class="hidden name"><code>hydromad.stats.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>These functions provide access to a built-in set of statistics, and also
allow the user to change or add named statistics.  Its usage is similar to
<code><a href="hydromad.options.html">hydromad.options</a></code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">hydromad.stats</span><span class="op">(</span><span class="va">...</span><span class="op">)</span>

<span class="fu">buildCachedObjectiveFun</span><span class="op">(</span>
  <span class="va">objective</span>,
  <span class="va">model</span>,
  DATA <span class="op">=</span> <span class="fu"><a href="utilities.html">observed</a></span><span class="op">(</span><span class="va">model</span>, select <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,
  Q <span class="op">=</span> <span class="va">DATA</span><span class="op">[</span>, <span class="st">"Q"</span><span class="op">]</span>
<span class="op">)</span>

<span class="fu">hmadstat</span><span class="op">(</span><span class="va">name</span>, DATA <span class="op">=</span> <span class="cn">NULL</span>, Q <span class="op">=</span> <span class="va">DATA</span><span class="op">[</span>, <span class="st">"Q"</span><span class="op">]</span><span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>...</dt>
<dd><p>new stats can be defined, or existing ones modified, using one
or more arguments of the form 'name = value' or by passing a list of such
tagged values.  Existing values can be retrieved by supplying the names (as
character strings) of the components as unnamed arguments.</p></dd>
<dt>objective</dt>
<dd><p>Placeholder</p></dd>
<dt>model</dt>
<dd><p>Placeholder</p></dd>
<dt>DATA, Q</dt>
<dd><p>If either <code>DATA</code> or <code>Q</code> is given, the returned
statistic function will be pre-evaluated with the given data. Technically,
any special <code>.()</code> expressions in the named objective function will be
evaluated and may refer to variables <code>DATA</code> and/or <code>Q</code>.  These
chunks are cached so that repeated evaluation of the objective function is
faster; but it is then only valid for models using the same dataset.
Remember that objective functions are normally evaluated on time series with
the warmup period removed, not the whole time series passed to
<code>hydromad</code>. The observed data excluding warmup can be extracted from a
model object as <code>Q = observed(model)</code> or <code>DATA = observed(model,
select = TRUE)</code>.</p></dd>
<dt>name</dt>
<dd><p>character giving the name of a statistic.</p></dd>
</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p><code>hmadstat</code> returns the named statistical function, while
<code>hydromad.stats</code> gets or sets a list of named functions.</p>
<p>The default set of available statistics can be listed with
<code>str(hydromad.stats())</code>, and consists of:</p>
<dl><dt>abs.err</dt>
<dd><p>the mean absolute error.</p></dd>

<dt>RMSE</dt>
<dd><p>Root Mean Squared Error.</p></dd>

<dt>bias</dt>
<dd><p>bias in data units, \(\sum ( X - Q )\)</p></dd>

<dt>rel.bias</dt>
<dd><p>bias as a fraction of the total observed flow, \(\sum
( X - Q ) / \sum Q\) (excluding any time steps with missing values).</p></dd>

<dt>r.squared</dt>
<dd><p>R Squared (Nash-Sutcliffe Efficiency), \(1 - \sum (Q-
X)^2 / \sum (Q - \bar{Q})^2\)</p></dd>

<dt>r.sq.sqrt</dt>
<dd><p>R Squared using square-root
transformed data (less weight on peak flows), \(1 - \frac{\sum |\sqrt{Q}
- \sqrt{X}|^2 }{ \sum |\sqrt{Q} - \bar{\sqrt{Q}}|^2 }\)</p></dd>

<dt>r.sq.log</dt>
<dd><p>R Squared using log transformed data, with an offset:
\(1 - \frac{\sum | \log{(Q+\epsilon)} - \log{(X+\epsilon)}|^2 }
{\sum |\log{(Q+\epsilon)} - \bar{\log{(Q+\epsilon)}}|^2 }\).
Here \(\epsilon\) is the 10 percentile (i.e. lowest decile) of the non-
zero values of Q.</p></dd>

<dt>r.sq.boxcox</dt>
<dd><p>R Squared using a Box-Cox transform. The power lambda is
chosen to fit Q to a normal distribution. When lambda = 0 it is a log
transform; otherwise it is \(y_* = \frac{(y+\epsilon)^\lambda - 1}
{\lambda}\) Here \(\epsilon\) is the 10 percentile (i.e. lowest decile) of
the non-zero values of Q.</p></dd>

<dt>r.sq.diff</dt>
<dd><p>R Squared using differences between successive time steps,
i.e. rises and falls.</p></dd>

<dt>r.sq.monthly</dt>
<dd><p>R Squared with data aggregated into calendar months.</p></dd>

<dt>r.sq.smooth5</dt>
<dd><p>R Squared using data smoothed with a triangular kernel
of width 5 time steps: <code>c(1,2,3,2,1)/9</code>.</p></dd>

<dt>r.sq.seasonal</dt>
<dd><p>R Squared where the reference model is the mean in
each calendar month, rather than the default which is the overall mean.</p></dd>

<dt>r.sq.vartd</dt>
<dd><p><code><a href="nseVarTd.html">nseVarTd</a></code> R Squared where the modelled peaks
have been coalesced to observed peaks, minimising timing error. Note that
this statistic requires <code>event</code> to be specified using
<code><a href="events.html">eventseq</a></code></p></dd>

<dt>persistence</dt>
<dd><p>R Squared where the reference model predicts each time
step as the previous observed value. This statistic therefore represents a
model's performance compared to a <em>naive</em> one-time-step forecast.</p></dd>

<dt>X0</dt>
<dd><p>correlation of modelled flow with the model residuals.</p></dd>

<dt>X1</dt>
<dd><p>correlation of modelled flow with the model residuals from the
previous time step.</p></dd>

<dt>ARPE</dt>
<dd><p>Average Relative Parameter Error. Requires that a variance-
covariance matrix was estimated during calibration.</p></dd>

<dt>KGE</dt>
<dd><p>Kling-Gupta Efficiency. \(KGE = 1 - \sqrt{(r - 1)^2 + (\alpha
- 1)^2 + (\Beta - 1)^2}\), where r is the linear correlation between
observations and simulations, α a measure of the flow variability error, and
β a bias term. Equivalently, it can be expressed as: <code>1 -
sqrt( cor(X, Q)^2 + (sd(X)/sd(Q) - 1)^2 + (mean(X)/mean(Q) - 1)^2 )</code>.</p></dd>


</dl></div>
    <div id="references">
    <h2>References</h2>
    <p>Gupta, H.V., Kling, H., Yilmaz, K.K., &amp; Martinez, G.F. (2009).
Decomposition of the mean squared error and NSE performance criteria:
Implications for improving hydrological modelling. Journal of Hydrology,
377(1), 80–91. https://doi.org/10.1016/j.jhydrol.2009.08.003</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="buildTsObjective.html">buildTsObjective</a></code>, <code><a href="nseStat.html">nseStat</a></code>,
<code><a href="objFunVal.html">objFunVal</a></code>, <code><a href="summary.hydromad.html">summary.hydromad</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"><span class="co">## see current set of stats</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="fu">hydromad.stats</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] "bias"           "rel.bias"       "abs.err"        "RMSE"          </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5] "r.squared"      "r.sq.sqrt"      "r.sq.log"       "r.sq.boxcox"   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9] "r.sq.rank"      "r.sq.diff"      "r.sq.monthly"   "r.sq.365"      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13] "r.sq.smooth5"   "r.sq.seasonal"  "r.sq.vs.tf"     "r.sq.vs.tf.bc" </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17] "persistence"    "persistence.bc" "e.rain5"        "e.rain5.log"   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [21] "e.rain5.bc"     "e.q90"          "e.q90.log"      "e.q90.bc"      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] "e.q90.all"      "e.q90.all.log"  "e.q90.all.bc"   "e.q90.min"     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [29] "e.q90.min.log"  "ar1"            "X0"             "X1"            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [33] "U1"             "r.sq.vartd"     "KGE"           </span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## extract only one</span></span>
<span class="r-in"><span class="fu">hmadstat</span><span class="op">(</span><span class="st">"RMSE"</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function (Q, X, ...) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sqrt(mean((X - Q)^2, na.rm = TRUE))</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;bytecode: 0x7fc11ccaea00&gt;</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> &lt;environment: 0x7fc11cc95e90&gt;</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## calculate stat value with random data</span></span>
<span class="r-in"><span class="fu">hmadstat</span><span class="op">(</span><span class="st">"rel.bias"</span><span class="op">)</span><span class="op">(</span>Q <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, X <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">11</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 0.1818182</span>
<span class="r-in"></span>
<span class="r-in"><span class="co">## add a new objective function.</span></span>
<span class="r-in"><span class="co">## A weighted combination of NSE and bias</span></span>
<span class="r-in"><span class="co">## as proposed by Neil Viney</span></span>
<span class="r-in"><span class="co">## OF = NSE – 5*|ln(1+Bias)|^2.5</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="fu">hydromad.stats</span><span class="op">(</span><span class="st">"viney"</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">Q</span>, <span class="va">X</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="fu">hmadstat</span><span class="op">(</span><span class="st">"r.squared"</span><span class="op">)</span><span class="op">(</span><span class="va">Q</span>, <span class="va">X</span>, <span class="va">...</span><span class="op">)</span> <span class="op">-</span></span>
<span class="r-in">    <span class="fl">5</span> <span class="op">*</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fu">hmadstat</span><span class="op">(</span><span class="st">"rel.bias"</span><span class="op">)</span><span class="op">(</span><span class="va">Q</span>, <span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2.5</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span><span class="op">)</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Joseph Guillaume.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer></div>

  


  

  </body></html>

